# 비동기 프로그래밍

## 동기식 처리 모델과 비동기식 처리 모델

**동기식 처리 모델 :**

- 현재 실행중인 태스크가 종료할 때까지 다음 실행될 태스크가 대기하는 방식
- 태스크를 순서대로 처리한다. (처리 순서가 보장되는 장점)
- 앞선 태스크가 종료할 때까지 이후 태스크들이 블로킹(작업 중단)되는 단점

**비동기식 처리 모델 :** 

- 현재 실행중인 태스크가 종료되지 않은 상태라 하더라도 다음 태스크를 곧바로 실행하는 방식

- 처리 순서가 보장되지 않는 단점

- 블로킹이 발생하지 않는다는 장점

- 타이머 함수 / HTTP 요청은 비동기식 처리 모델로 동작한다.

  타이머를 돌리는 시점
  => call stack 에서 돌리면 블로킹이 일어난다.
  => 브라우저에서 돌려야 한다.

- 자바스크립트에 동시성을 부여한다. (이벤트 루프로 구현)

**자바스크립트 엔진**은 싱글스레드로 동작(콜스택)
**브라우저**는 멀티스레드



## 이벤트 루프와 동시성

자바스크립트의 특징 중 하나는 싱글 스레드로 동작한다는 것이다.
싱글 스레드 방식은 한번에 하나의 태스크만을 처리하는것을 의미한다.

브라우저가 많은 태스크를 동시에 처리되는것처럼 느껴지는것은
자바스크립트의 동시성을 지원하는 이벤트 루프때문이다.



**자바스크립트 엔진**

- 콜 스택

  소스코드의 평가에 의해 생성된 실행 컨테스트가 추가되고 제거되는 스택 자료구조인 실행 컨텍스트 스택이 바로 콜 스택이다.

- 힙

  객체가 할당되는 구조화되지 않은 넓은 메모리 영역이다.

자바스크립트 엔진은 동시성을 지원하기 위해 **필요한 비동기 요청 처리**(예를들어 타이머 함수)는 자바스크립트 엔진을 구동하는 환경 즉 **브라우저 / Node.js**가 담당한다.

이를 위해 **브라우저 환경은 태스크 큐와 이벤트 루프**를 제공한다.

- 태스크 큐

  비동기 처리 함수의 콜백 함수 또는 이벤트 핸들러가 일시적으로 보관되는 영역이다. 태스크 큐에서 대기중인 함수는 **콜스택이 비어졌을 때** 이벤트 루프에 의해 순차적으로 콜스택으로 이동되어 실행된다.

  태스크 큐에 일시 보관된 함수들은 비동기 처리 모델로 동작한다.

- 이벤트 루프

  1. 콜 스택에 현재 실행중인 실행 컨텍스트가 있는지 
  2. 그리고 태스크 큐에 대기중인 함수가 있는지 반복하여 확인한다. 
  
  만약 콜 스택이 비어있다면 태스크 큐에서 대기중인 함수를 순차적으로 콜스택으로 이동시킨다.



자바스크립트는 싱글 스레드 방식으로 동작한다.
싱글 스레드 방식으로 동작하는 것은 브라우저가 아니라 **자바스크립트 엔진**이라는것에 주의!
**(브라우저는 멀티스레드!!)**

만약 모든 자바스크립트 코드가 자바스크립트 엔진에서 싱글 스레드 방식으로 동작한다면 자바스크립트는 비동기적으로 동작할 수 없다. 